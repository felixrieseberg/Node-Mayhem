/* 
 * joy.js v0.2.1 
 * http://joyjs.org
 * 
 * @copyright 2012-2013 Endel Dreyer 
 * @license MIT
 * @build 7/20/2013
 */
(function(t){var e=t.Joy||{Init:{},Render:{},Input:{},Context:{},debug:!1,deltaTime:1,ready:function(t){document.onload=t}};e.generateUniqueId=function(){return"joy"+(new Date).getTime()},t.Joy=e})(window),function(t){t.CompositeOperation={SOURCE_OVER:"source-over",SOURCE_IN:"source-in",SOURCE_OUT:"source-out",SOURCE_ATOP:"source-atop",LIGHTER:"lighter",XOR:"xor",DESTINATION_OVER:"destination-over",DESTINATION_IN:"destination-in",DESTINATION_OUT:"destination-out",DESTINATION_ATOP:"destination-atop",DESTINATION_COPY:"copy"}}(Joy),function(t){t.Events={INIT:"init",SCENE_ACTIVE:"sceneActive",ADDED:"added",REMOVED:"removed",UPDATE:"update",COLLISION:"collision",COLLISION_ENTER:"collisionEnter",COLLISION_EXIT:"collisionExit"}}(Joy),function(){var t=!1,e=/xyz/.test(function(){"xyz"})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(i){function n(){!t&&this.init&&this.init.apply(this,arguments)}var o=this.prototype;t=!0;var r=new this;t=!1;for(var s in i)r[s]="function"==typeof i[s]&&"function"==typeof o[s]&&e.test(i[s])?function(t,e){return function(){var i=this._super;this._super=o[t];var n=e.apply(this,arguments);return this._super=i,n}}(s,i[s]):i[s];return n.prototype=r,n.prototype.constructor=n,n.extend=arguments.callee,n},Joy.Object=Class}(Joy),function(t){t.currentEngine=null;var e=function(e){if(t.currentEngine=this,this.paused=!1,"string"==typeof e.tagName&&"CANVAS"===e.tagName){e={canvas:e};var i=Joy.Markup.evaluateDataset(e.canvas);for(var n in i)e[n]=i[n]}if(e.canvas&&(this.context=new Joy.Context.Context2d({canvas:e.canvas})),!this.context){var o=e.context||Joy.Context.Context2d;this.context=new o({canvas:document.createElement("canvas")}),document.body.appendChild(this.context.canvas)}e.width&&(this.context.canvas.width=e.width),e.height&&(this.context.canvas.height=e.height),this.context.canvas.style.width=this.context.canvas.width/window.devicePixelRatio+"px",this.context.canvas.style.height=this.context.canvas.height/window.devicePixelRatio+"px",e.fullscreen&&(window.onresize=function(){}),t.Mouse!==void 0&&t.Mouse.enable(this),e.debug&&(Joy.debug=!0),this.scenes=[],Object.defineProperty(this,"width",{get:function(){return this.context.canvas.width},configurable:!0}),Object.defineProperty(this,"height",{get:function(){return this.context.canvas.height},configurable:!0}),Object.defineProperty(this,"currentScene",{get:function(){return this.scenes[this._currentSceneIndex]},set:function(e){null!==this._currentSceneIndex&&(this.scenes[this._currentSceneIndex].visible=!1,this.scenes[this._currentSceneIndex].viewport.reset()),this.sceneLoader&&e.loader.loading?(this._currentSceneIndex=this.scenes.indexOf(this.sceneLoader),this.sceneLoader.loader=e.loader,this.sceneLoader.visible=!0,e.visible=!1,e.loader.bind("loadComplete",function(){t.currentEngine.gotoScene(e)})):(this._currentSceneIndex=this.scenes.indexOf(e),e.visible=!0,e.broadcast(t.Events.SCENE_ACTIVE,[e]))}}),this._currentSceneIndex=null,this.sceneLoader=null,this.setSceneLoader(t.Engine.defaultSceneLoader),this.context.canvas.children.length>0&&(this.markup=new t.Markup(this).parse()),Joy.debug?(this._lastRenderTime=new Date,this._frameRateText=new Joy.Text({x:4,y:4,font:"12px Verdana",color:"red"}),this.onEnterFrameDebug()):this.onEnterFrame()};e.prototype.createScene=function(e){var i=new t.Scene({ctx:this.context.ctx});return"function"==typeof e&&e.apply(this,[i]),this.addScene(i),i},e.prototype.setSceneLoader=function(e){var i="object"==typeof e?e:new t.Scene({ctx:this.context.ctx,loader:null});return"function"==typeof e&&e.apply(this,[i]),-1===this.scenes.indexOf(i)&&this.scenes.push(i),this.sceneLoader=i,i},e.prototype.pause=function(){this._deltaTime=t.deltaTime,t.deltaTime=0,this.paused=!0},e.prototype.resume=function(){t.deltaTime=this._deltaTime,this.paused=!1},e.prototype.gotoNextScene=function(t,e){if(this.scenes[this._currentSceneIndex+1]===void 0)throw Error("There is no next scene.");return this.gotoScene(this.scenes[this._currentSceneIndex+1],t,e)},e.prototype.gotoScene=function(t,e,i){var n=this;return e||(e=1e3),i||(i="#000"),this.currentScene.fadeOut(e,i).bind("fadeOutComplete",function(){n.currentScene=t,n.currentScene.fadeIn(e,i)}),this},e.prototype.addScene=function(t){t.engine=this,t.setContext(this.context.ctx),Joy.debug&&t.viewport.addHud(this._frameRateText),this.scenes.push(t),null===this._currentSceneIndex&&(this.currentScene=t)},e.prototype.render=function(){this.context.render(this.scenes)},e.prototype.onEnterFrame=function(){t.currentEngine.paused||(t.TweenManager.update(),t.currentEngine.render()),window.onEnterFrame(t.currentEngine.onEnterFrame)},e.prototype.onEnterFrameDebug=function(){var e=new Date;t.currentEngine._frameRateText.text=""+(1e3/(e-t.currentEngine._lastRenderTime)).toFixed(1)+" FPS",t.currentEngine.paused||(t.TweenManager.update(),t.currentEngine.render()),t.currentEngine._lastRenderTime=e,window.onEnterFrame(t.currentEngine.onEnterFrameDebug)},t.Engine=e}(Joy),function(t){function e(t){return""!==n&&(t=t.charAt(0).toUpperCase()+t.slice(1)),n+t}var i=navigator.userAgent,n=i.match(/opera/i)&&"o"||i.match(/webkit/i)&&"webkit"||i.match(/msie/i)&&"ms"||i.match(/mozilla/i)&&"moz"||"";"function"!=typeof window.addEventListener&&(HTMLElement.prototype.addEventListener=function(t,e){attachEvent("on"+t,e)}),t.Support={touch:"ontouchstart"in window,retina:window.devicePixelRatio>1||window.matchMedia("(min-resolution: 1.1dppx)").matches,imageSmoothingEnabled:e("imageSmoothingEnabled")},window.onEnterFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()}(Joy),function(t){var e=t.Object.extend({init:function(t){this._handlers=t&&t._handlers||{},this._behaviours=t&&t._behaviours||[]},behave:function(e,i){var n;if("string"==typeof e){var o,r=e.split(",");for(n=0,l=r.length;l>n;n++)o=this.behave(t.Behaviour.get(r[n].replace(" ","")),i);return o}this._behaviours.push(e.id);var s=new e(i);for(n in s)"string"==typeof Joy.Events[n]?this.bind(Joy.Events[n],s[n]):"constructor"!==n&&(this[n]=s[n]);return this},hasBehaviour:function(t){return this._behaviours.indexOf(t)>=0},bind:function(t,i){var n=i;return void 0!==e._custom.bind[t]&&(n={target:this,handler:i},e._custom.bind[t].call(this,n)),void 0===this._handlers[t]&&(this._handlers[t]=[]),-1===this._handlers[t].indexOf(n)&&this._handlers[t].push(n),this},unbind:function(t){if(void 0!==e._custom.unbind[t])for(var i=0,n=this._handlers[t].length;n>i;++i)e._custom.unbind[t].call(this,this._handlers[t][i]);return this._handlers[t]=null,this},trigger:function(t,e,i){var n=this._handlers[t]||[];e=e||[],i=i||0;for(var o=0,r=n.length;r>o;++o)n[o].apply(this,e)},broadcast:function(t,e,i){this.trigger(t,e,i)}});e._custom={bind:{},unbind:{}},e.register=function(t,i,n){return e._custom.bind[t]=i,e._custom.unbind[t]=n,this},e.register(Joy.Events.INIT,function(t){t.handler.call(this)}),t.Triggerable=e}(Joy),function(){Math.clamp=function(t,e,i){return e>t?e:t>i?i:+t}}(Joy),function(t){var e=function(t,e,i,n,o,r){return null!==t&&(this.m11=t),this.m12=e||0,this.m21=i||0,null!==n&&(this.m22=n),this.dx=o||0,this.dy=r||0,this};e.prototype.appendTransform=function(t,i,n,o,r,s,a,h,c){var u,l,d;return r%360?(d=r*e.DEG_TO_RAD,u=Math.cos(d),l=Math.sin(d)):(u=1,l=0),s||a?(s*=e.DEG_TO_RAD,a*=e.DEG_TO_RAD,this.append(Math.cos(a),Math.sin(a),-Math.sin(s),Math.cos(s),t,i),this.append(u*n,l*n,-l*o,u*o,0,0)):this.append(u*n,l*n,-l*o,u*o,t,i),(h||c)&&(this.dx-=h*this.m11+c*this.m21,this.dy-=h*this.m12+c*this.m22),this},e.prototype.append=function(t,e,i,n,o,r){var s=this.m11,a=this.m12,h=this.m21,c=this.m22;return this.m11=t*s+e*h,this.m12=t*a+e*c,this.m21=i*s+n*h,this.m22=i*a+n*c,this.dx=o*s+r*h+this.dx,this.dy=o*a+r*c+this.dy,this},e.prototype.invert=function(){var t=this.m11,e=this.m12,i=this.m21,n=this.m22,o=this.dx,r=t*n-e*i;return this.m11=n/r,this.m12=-e/r,this.m21=-i/r,this.m22=t/r,this.dx=(i*this.dy-n*o)/r,this.dy=-(t*this.dy-e*o)/r,this},e.prototype.clone=function(){return new e(this.m11,this.m12,this.m21,this.m22,this.dx,this.dy)},e.prototype.identity=function(){return this.m11=this.m22=1,this.m12=this.m21=this.dx=this.dy=0,this},e.DEG_TO_RAD=Math.PI/180,e.identity=new e(1,0,0,1,0,0),t.Matrix2D=e}(Joy),function(t){var e=function(t,e){var i=t,n=e;"object"==typeof i&&(i=t.min||0,n=t.max||0),this.min=parseFloat(i||0,10),this.max=parseFloat(n||this.min||0,10)};e.prototype.random=function(){return e.random(this.min,this.max)},e.prototype.randomInt=function(){return e.randomInt(this.min,this.max)},e.parse=function(t){if("string"==typeof t){var i=t.split("..");return new e(i[0],i[1])}return new e(t)},e.random=function(t,e){return Math.random()*(e-t+1)+t},e.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},t.Range=e}(Joy),function(t){var e=function(t,i){this.x=t||0,this.y=i||0,Object.defineProperty(this,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},configurable:!0}),Object.defineProperty(this,"normalized",{get:function(){var t=this.length;return new e(this.x/t,this.y/t)},configurable:!0})};e.prototype.set=function(t,e){return this.x=t,this.y=e,this},e.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.sum=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.scale=function(t,e){return this.x*=t,this.y*=e||t,this},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.unit=function(){return new e(Math.cos(this.x),Math.sin(this.y))},e.prototype.normalize=function(){var t=this.normalized;return this.x=t.x,this.y=t.y,this},e.distance=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},e.prototype.toString=function(){return"#<Vector2d @x="+this.x+", @y="+this.y+">"},e.LEFT=new e(-1,0),e.RIGHT=new e(1,0),e.TOP=new e(0,-1),e.BOTTOM=new e(0,1),t.Vector2d=e}(Joy),function(t){var e=function(t,e,i,n){this.red=t,this.green=e,this.blue=i,this.alpha=n};e.prototype.toString=function(){return this.green||this.blue?this.alpha?"rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")":"rgb("+this.red+","+this.green+","+this.blue+")":this.red},t.Color=e}(Joy),function(t){var e=t.Triggerable.extend({init:function(){this._super(),this.assets=[],this.loaded=0,Object.defineProperty(this,"percentage",{get:function(){return Math.round(100*(this.loaded/this.assets.length))},configurable:!0}),Object.defineProperty(this,"loading",{get:function(){return this.assets.length!==this.loaded},configurable:!0}),Object.defineProperty(this,"completed",{get:function(){return this.assets.length>0&&!this.loading},configurable:!0})},add:function(t){var e=this;this.assets.push(t),t.addEventListener("load",function(){e.loaded+=1,e.trigger("loadProgress"),e.loaded==e.assets.length&&e.trigger("loadComplete")})}});t.Loader=e}(Joy),function(t){var e=function(){};e.process=function(t,e){var i=t.getImageData(0,0,t.canvas.width,t.canvas.height);e.call(this,i),t.putImageData(i,0,0)};var i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],n=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];e.blur=function(t){var e,o,r,s,a,h,c,u,l,d,f,p,v,g,y,m,_,w,x,E,b,A=function(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},T=t.data,O=5,S=t.width,C=t.height,I=O+O+1,P=S-1,M=C-1,N=O+1,D=N*(N+1)/2,L=new A,R=L;for(r=1;I>r;r++)R=R.next=new A,r==N&&(b=R);R.next=L;var J=null,k=null;c=h=0;var Y=i[O],U=n[O];for(o=0;C>o;o++){for(g=y=m=u=l=d=0,f=N*(_=T[h]),p=N*(w=T[h+1]),v=N*(x=T[h+2]),u+=D*_,l+=D*w,d+=D*x,R=L,r=0;N>r;r++)R.r=_,R.g=w,R.b=x,R=R.next;for(r=1;N>r;r++)s=h+((r>P?P:r)<<2),u+=(R.r=_=T[s])*(E=N-r),l+=(R.g=w=T[s+1])*E,d+=(R.b=x=T[s+2])*E,g+=_,y+=w,m+=x,R=R.next;for(J=L,k=b,e=0;S>e;e++)T[h]=u*Y>>U,T[h+1]=l*Y>>U,T[h+2]=d*Y>>U,u-=f,l-=p,d-=v,f-=J.r,p-=J.g,v-=J.b,s=c+(P>(s=e+O+1)?s:P)<<2,g+=J.r=T[s],y+=J.g=T[s+1],m+=J.b=T[s+2],u+=g,l+=y,d+=m,J=J.next,f+=_=k.r,p+=w=k.g,v+=x=k.b,g-=_,y-=w,m-=x,k=k.next,h+=4;c+=S}for(e=0;S>e;e++){for(y=m=g=l=d=u=0,h=e<<2,f=N*(_=T[h]),p=N*(w=T[h+1]),v=N*(x=T[h+2]),u+=D*_,l+=D*w,d+=D*x,R=L,r=0;N>r;r++)R.r=_,R.g=w,R.b=x,R=R.next;for(a=S,r=1;O>=r;r++)h=a+e<<2,u+=(R.r=_=T[h])*(E=N-r),l+=(R.g=w=T[h+1])*E,d+=(R.b=x=T[h+2])*E,g+=_,y+=w,m+=x,R=R.next,M>r&&(a+=S);for(h=e,J=L,k=b,o=0;C>o;o++)s=h<<2,T[s]=u*Y>>U,T[s+1]=l*Y>>U,T[s+2]=d*Y>>U,u-=f,l-=p,d-=v,f-=J.r,p-=J.g,v-=J.b,s=e+(M>(s=o+N)?s:M)*S<<2,u+=g+=J.r=T[s],l+=y+=J.g=T[s+1],d+=m+=J.b=T[s+2],J=J.next,f+=_=k.r,p+=w=k.g,v+=x=k.b,g-=_,y-=w,m-=x,k=k.next,h+=S}},e.noise=function(t){var e,i,n,o=0;for(e=0;t.width>e;++e)for(i=0;t.height>i;++i)n=.8*Math.random(),o=4*e+i*4*t.width,t.data[o]*=n,t.data[o+1]*=n,t.data[o+2]*=n},t.Shader=e}(Joy),function(t){t.Utils={applyFriction:function(e,i){return 0>e+i?e+i*t.deltaTime:e-i>0?e-i*t.deltaTime:0}}}(Joy),function(t){t.Engine.defaultSceneLoader=function(t){var e,i,n,o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEcAAABkCAMAAADjVt21AAADAFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJBwYjGxnlTCblTCblTCblTSflTSblTijlTijlTyjlTynlUSrlUSvmUy7lUy3lVS/mVzHmWDLnWjbmXDbnYD3oYT3oYTrrYjTvYyzqYzrtYzCCZF3oZELoZUPoZELqbUzqdFXreFrre13sfF/sgGXsg2fthmztiW+zjILtjHPujnXuknrvln/vmYLwnIfxoIvxo47xpZHyqJXYqZ3yqpfyrZvzr57zs6L0tqb0uqvuvK7yv7L2w7b0w7b2xbn2xrr2x7vs7/Dt8PHw8vL19vb7+/v+/v7////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+/fz//v7+/v7s8vTs8/Xs8/Xs8vTs8fP47uvs7e3s7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozz497y3NTx187w0cfxy77xwK/xtJ/vq5Xuo4rsnobsl33sk3ftj3DsiWnuhF/sfFbsc0vrbUTyaC3yaC7yaC3yaC7pZ0DyZyvyZirxZizzZSjxZCjxZCjxZCjxZCjyZSnyZSjxZCryZSjxZCjxZCjxZCjxZCjzZSjzZSjzZSjxZSnwYinwYSfwYSjxYCPwYCTwYCbxXyDxXyLxXR3xXR7xXh/vXCDxXB3uWyLsWibrWSbrWCfqVyfpViboUyToUCLlTiflTiblTiblTiblTiblTSblTSblTSblTSblTSblTSblTSblTSblTSblTSblTSblTSblTCbkTCblTCblTCblTCXlTCXlTCTlSyTlSyPmSx/lSiPlSiLlSSLkSSHlSR7kSCDkSCDkRx/kRh7kRh3lRh3kRh7kRRzlRRzkRBzlRBvlRBtkxwbdAAAAeXRSTlMAAAAAAAAAAAAAAAECX19fX2Bk/mL+/Px3+vtx+pD9qoT97Pnh8ga/ydKYpaShnpaQiIAHeHNpYVpTS0Q+NgcyLCYiHRoHBxQHDwgM/vrR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",r={percentage:0},s=this;t.background("#000"),n=new Joy.Text({x:s.width/2,y:s.height/2,text:"0%",align:"center",font:"30pt Courier New, monospace",color:"#fff",alpha:0,baseline:Joy.Text.BASELINE.MIDDLE}).bind(Joy.Events.UPDATE,function(){var i=this;r.percentage!==t.loader.percentage&&(e&&e.stop(),r.percentage=t.loader.percentage,e=Joy.Tween({percentage:parseInt(i.text,10)},1e3).easing(Joy.TweenManager.Easing.Quadratic.Out).to({percentage:t.loader.percentage}).onUpdate(function(){i.text=parseInt(this.percentage,10)+"%"}).start())}),i=new Joy.Sprite(o).bind("load",function(){this.alpha=0,this.position.x=s.width/2,this.position.y=s.height/2,this.pivot.x+=this.width/2,this.pivot.y+=this.height/2,Joy.Tween(this.position).to({x:this.position.x-50}).easing(Joy.TweenManager.Easing.Quadratic.Out).start(),Joy.Tween(this,1e3).to({alpha:1}).easing(Joy.TweenManager.Easing.Quadratic.Out).start(),Joy.Tween(n,1e3).to({alpha:1}).easing(Joy.TweenManager.Easing.Quadratic.Out).start(),Joy.Tween(n.position,3e3).to({x:n.position.x+50}).easing(Joy.TweenManager.Easing.Quadratic.Out).start()}),t.addChild(i),t.addChild(n)}}(Joy),function(t){var e=t.Triggerable.extend({init:function(e){e||(e={}),this.id=e.id||Joy.generateUniqueId(),this.position=e.position||new t.Vector2d(e.x||0,e.y||0),Object.defineProperty(this,"collidePosition",{get:function(){var e=null!==this._parent?this._parent.collidePosition:new t.Vector2d;return e.sum(this.position).subtract(this.pivot)},configurable:!0}),this.pivot=e.pivot||new t.Vector2d(e.pivotX||0,e.pivotY||0),this.skew=e.skew||new t.Vector2d(e.skewX||0,e.skewY||0),this.scale=e.scale||new t.Vector2d(e.scaleX||1,e.scaleY||1),this.alpha=e.alpha===void 0?1:e.alpha,this.rotation=e.rotation||0,this.smooth=e.smooth===void 0?!0:e.smooth,this.destroyed=!1,this._width=e.width||0,this._height=e.height||0,Object.defineProperty(this,"collider",{get:function(){return this._collider},set:function(t){this._collider=t,this._collider.target=this},configurable:!0}),this._collider=e.collider||this,this.index=null,this.ctx=e.ctx||null,this._shadow=null,this._parent=null,this._visible=e.visible===void 0?!0:e.visible,this._matrix=t.Matrix2D.identity.clone(),this._collisionTargets=[],this._collisionActive={},this._hasContextOperations=!1,this._contextOperations={},Object.defineProperty(this,"parent",{get:function(){return this._parent},configurable:!0}),Object.defineProperty(this,"scene",{get:function(){for(var e=this._parent;!(e instanceof t.Scene)&&null!==e;)e=e&&e.parent||null;return e},configurable:!0}),Object.defineProperty(this,"visible",{get:function(){return this._visible&&this.alpha>0&&0!==this.scale.y&&0!==this.scale.y},set:function(t){this._visible=t},configurable:!0}),Object.defineProperty(this,"matrix",{get:function(){return this._matrix},configurable:!0}),Object.defineProperty(this,"width",{get:function(){return this._width*Math.abs(this.scale.x)},configurable:!0}),Object.defineProperty(this,"height",{get:function(){return this._height*Math.abs(this.scale.y)},configurable:!0}),Object.defineProperty(this,"right",{get:function(){return this.position.x+this.width},configurable:!0}),Object.defineProperty(this,"bottom",{get:function(){return this.position.y+this.height},configurable:!0}),this.flipX=e.flipX||!1,this.flipY=e.flipY||!1,this._super(e),this.collider&&this.bind(t.Events.UPDATE,this.checkCollisions)},setContext:function(t){this.ctx=t},destroy:function(){return this.destroyed=!0,this},setScale:function(t,e){this.scale.x=t,this.scale.y=e},allowCollisionFrom:function(e){e instanceof t.DisplayObject&&(e=[e]);for(var i=0,n=e.length;n>i;++i)this._collisionTargets.push(e[i]);return this},translate:function(t,e){return this._hasContextOperations=!0,this._contextOperations.translate=[t,e],this},rotate:function(t){this.rotation=t},transform:function(t,e,i,n,o,r){return this._contextOperations.transform=[t,e,i,n,o,r],this},composite:function(t){return this.compositeOperation=t,this},fillStyle:function(t){return this._hasContextOperations=!0,this._contextOperations.fillStyle=""+t,this},fillRect:function(t,e,i,n){return this._hasContextOperations=!0,this._contextOperations.fillRect=[t,e,i,n],this},shadow:function(t){return this._shadow=t?{color:t.color||"#000",offsetX:t.offsetX||0,offsetY:t.offsetY||0,blur:t.blur||1}:null,this},updateContext:function(){var e={};e[!1]=-1,e[!0]=1;var i=this._matrix.identity().appendTransform(this.position.x+this.width*(this.flipX+0),this.position.y+this.height*(this.flipY+0),this.scale.x*e[!this.flipX],this.scale.y*e[!this.flipY],this.rotation,this.skew.x,this.skew.y,this.pivot.x,this.pivot.y);this.ctx.transform(i.m11,i.m12,i.m21,i.m22,i.dx,i.dy),this.ctx.globalAlpha*=this.alpha,this.compositeOperation&&(this.ctx.globalCompositeOperation=this.compositeOperation),this.ctx[t.Support.imageSmoothingEnabled]=this.smooth,this._shadow&&(this.ctx.shadowColor=this._shadow.color,this.ctx.shadowOffsetX=this._shadow.offsetX,this.ctx.shadowOffsetY=this._shadow.offsetY,this.ctx.shadowBlur=this._shadow.blur)},collide:function(t){return!(this.collidePosition.x>=t.collidePosition.x+t.width||t.collidePosition.x>=this.collidePosition.x+this.width||this.collidePosition.y>=t.collidePosition.y+t.height||t.collidePosition.y>=this.collidePosition.y+this.height)},checkCollisions:function(){var e,i=this._collisionTargets.length;if(0!==i){void 0!==this.collider.updateColliderPosition&&this.collider.updateColliderPosition(this.position),t.debug&&this.collider.renderStroke(this.ctx);for(var n=0;i>n;++n)e=this._collisionTargets[n].collider,e.collide(this.collider)?(this._collisionActive[e.id]||(this.trigger(t.Events.COLLISION_ENTER,[this._collisionTargets[n]]),this._collisionActive[e.id]=!0),this.trigger(t.Events.COLLISION,[this._collisionTargets[n]])):this._collisionActive[e.id]&&(delete this._collisionActive[e.id],this.trigger(t.Events.COLLISION_EXIT,[this._collisionTargets[n]]))}},willCollideAt:function(e){var i=new t.RectCollider(this.collider.position.clone().sum(e),1,1),n=this._collisionTargets.length;if(0!==n){i.updateColliderPosition(this.position);for(var o=0;n>o;++o)if(this._collisionTargets[o].collider.collide(i))return this._collisionTargets[o];return null}},render:function(){if(this.destroyed&&this.parent)return this.parent.removeChild(this),void 0;if(this._hasContextOperations)for(var t in this._contextOperations)this._contextOperations[t]instanceof Array?this.ctx[t].apply(this.ctx,this._contextOperations[t]):this.ctx[t]=this._contextOperations[t]},renderStroke:function(t){t.strokeStyle="red",t.strokeRect(this.collidePosition.x,this.collidePosition.y,this.width,this.height)},getMatrix:function(){return this._matrix.clone()},getBounds:function(){return new t.Rect(this.position.x,this.position.y,this.width,this.height)}});t.DisplayObject=e}(Joy),function(t){var e=t.DisplayObject.extend({init:function(t){if(t||(t={}),this.children=[],Object.defineProperty(this,"numChildren",{get:function(){return this.children.length},configurable:!0}),Object.defineProperty(this,"width",{get:function(){for(var t=0,e=0,i=this.children.length;i>e;++e)this.children[e].width>t&&(t=this.children[e].width);return t},configurable:!0}),Object.defineProperty(this,"height",{get:function(){for(var t=0,e=0,i=this.children.length;i>e;++e)this.children[e].height>t&&(t=this.children[e].height);return t},configurable:!0}),this._super(t),t.children)for(var e=0,i=t.children.length;i>e;++e)this.addChild(t.children[e])},setContext:function(t){this.ctx=t;for(var e=0,i=this.children.length;i>e;++e)this.children[e].setContext(t)},render:function(){this.visible&&(this.ctx.save(),this.updateContext(),this._super(),this.renderChildren(),this.ctx.restore())},renderChildren:function(){for(var e=0,i=this.children.length;i>e;++e)this.children[e].visible&&(this.ctx.save(),this.children[e].updateContext(),this.children[e].render(),this.children[e].trigger("update"),this.ctx.restore(),t.debug&&this.children[e].collider.renderStroke(this.ctx))},broadcast:function(t,e){this.trigger(t,e);for(var i=0,n=this.children.length;n>i;++i)this.children[i].trigger(t,e)},swapChildren:function(t,e){if(t.parent!==e.parent)throw Error("DisplayObject must be at same level to swap.");var i=t.index;return this.children[i]=e,this.children[e.index]=t,t.index=e.index,e.index=i,this},addChild:function(e){return e.setContext(this.ctx),e.index=this.children.push(e)-1,e._parent=this,e.scene&&e.broadcast(t.Events.ADDED,[this]),this},getChildById:function(t){for(var e=0,i=this.children.length;i>e;++e)if(this.children[e].id==t)return this.children[e]},getChildAt:function(t){return this.children[t]},removeChild:function(t){var e=this.children.indexOf(t);return-1!==e&&this.removeChildAt(e),this},removeChildAt:function(e){var i=this.children.splice(e,1)[0];return i.trigger(t.Events.REMOVED,[this]),this}});t.DisplayObjectContainer=e}(Joy),function(t){t.Object.extend({init:function(){}})}(Joy),function(t){var e=t.DisplayObjectContainer.extend({init:function(e){this._super(e),this.viewport=e.viewport||null,this.distance=e.distance||1,this.velocity=e.velocity||1,this.bind(t.Events.ADDED,this._setup)},_setup:function(e){if(!(e instanceof t.Scene))throw Error("'Parallax' instance must be added into a 'Scene'.");this.viewport=e.viewport;var i=this;this.viewport.bind("setup",function(){var t,e,n,o;for(t=0,e=i.numChildren;e>t;++t)if(i.getChildAt(t).position){for(n=i.getChildAt(t);n.numChildren>0;)n.removeChildAt(0);for(var r=0,s=Math.ceil(n.width/this.width)-1;s>r;++r)o=n.clone(),o.children=[],o.position.x=n.width,n.addChild(o)}}),this.viewport.bind("translate",function(){for(var t=i.distance,e=0,n=i.numChildren;n>e;++e)t*=i.velocity*(e+1),i.getChildAt(e).position&&(i.getChildAt(e).position.x+=this.translation.x*t/this.width,i.getChildAt(e).position.y+=this.translation.y*t/(this.height/2))})}});t.Parallax=e}(Joy),function(t){var e=t.DisplayObject.extend({init:function(e){this._super(e),this.emit=e.emit===void 0?!0:e.emit,this.sources=e.source!==void 0?[e.source]:e.sources,this.emission=e.emission!==void 0?new t.Range(e.emission):new t.Range(1,5),this.ease=e.ease||t.TweenManager.Easing.Linear,this.start=e.start||{},this.end=e.end||{},this.particleLifetime=e.particleLifetime!==void 0?new t.Range(e.particleLifetime):new t.Range(1,2),Object.defineProperty(this,"lifetime",{get:function(){return this._lifetime},set:function(e){this._lifetime=(e!==void 0?new t.Range(e):new t.Range(-1)).random()},configurable:!0}),this.lifetime=e.lifetime||1/0,this._ttl=1/0,this.bind(t.Events.ADDED,function(){for(var e=0,i=this.sources.length;i>e;e++)this.sources[e].trigger(t.Events.ADDED)}),this.bind(t.Events.SCENE_ACTIVE,this._activate)},_activate:function(){this._ttl=Date.now()+1e3*this.lifetime},_emit:function(e){for(var i,n=0;e>n;n+=1)i=this.sources[t.Range.randomInt(0,this.sources.length-1)].clone(),i.behave("Particle",{emitter:this,ease:this.ease,start:this.start,end:this.end,ttl:this.particleLifetime.random()}),this.parent.addChild(i);return this},render:function(){this._super(),!this.emit||Date.now()>this._ttl||this._emit(1)}});t.ParticleEmitter=e}(Joy),function(t){var e=t.DisplayObjectContainer.extend({init:function(e){e||(e={}),e.visible===void 0&&(e.visible=!1),this._super(e),this.loader=e.loader===void 0?new t.Loader:e.loader,this.paused=!1,this.shaders=[],this.viewport=e.viewport||new t.Viewport({scene:this})},background:function(e){return this.fillStyle(""+e),this.fillRect(0,0,this.width||t.currentEngine.width,this.height||t.currentEngine.height),this},pause:function(e){return e=e||{},e.blur&&(this.render(),t.Shader.process(this.ctx,t.Shader.blur,e.blur)),this.paused=!0,this.trigger("pause"),this},updateContext:function(){this._super(),this.viewport.follow&&this.viewport.updateContext()},render:function(){if(!this.paused&&(this.updateContext(),this._super(),this.viewport.render(),this.shaders.length>0))for(var e=0,i=this.shaders.length;i>e;++e)t.Shader.process(this.ctx,this.shaders[e][0],this.shaders[e][1])},broadcast:function(t,e){this.viewport.broadcast(t,e),this._super(t,e)},fadeOut:function(e,i){var n=this,o=new t.Rect({width:this.viewport.width,height:this.viewport.height,color:i,alpha:0});n.trigger("fadeOutStart"),this.viewport.addHud(o);var r=setInterval(function(){o.alpha+=1e3/e/60*t.deltaTime,o.alpha>=1&&(clearInterval(r),n.viewport.hud.removeChild(o),n.trigger("fadeOutComplete"))},1);return this},fadeIn:function(e,i){var n=this,o=new t.Rect({width:this.viewport.width,height:this.viewport.height,color:i,alpha:1});n.trigger("fadeInStart"),this.viewport.addHud(o);var r=setInterval(function(){o.alpha-=1e3/e/60*t.deltaTime,0>=o.alpha&&(clearInterval(r),n.viewport.hud.removeChild(o),n.trigger("fadeInComplete"))},1e3/60);return this},addShader:function(t,e){return this.shaders.push([t,e]),this}});t.Scene=e}(Joy),function(t){var e=t.DisplayObjectContainer.extend({init:function(e){"string"==typeof e&&(e={src:e}),this.image=e.image||new Image,e.width=this.image.width||e.width,e.height=this.image.height||e.height,this._super(e),this.bind(t.Events.ADDED,function(){e.src&&this.load(e.src)
})},load:function(t){var e=this;this.scene&&this.scene.loader&&!this.scene.loader.completed&&this.scene.loader.add(this.image),this.image.addEventListener("load",function(){e.onLoad(),e.trigger("load")}),this.image.src=t},onLoad:function(){this._width||(this._width=this.image.width),this._height||(this._height=this.image.height)},render:function(){this.visible&&(this.ctx.drawImage(this.image,0,0,this._width,this._height),this.renderChildren())},clone:function(){var e=new t.Sprite(this);return this.position=this.position.clone(),this.scale=this.scale.clone(),this.pivot=this.pivot.clone(),this.skew=this.skew.clone(),e}});t.Sprite=e}(Joy),function(t){var e=function(t){this.parent=t.parent,this.name=t.name,this.framesPerSecond=t.framesPerSecond,this.frames=t.frames,this.firstFrame=this.frames[0],this.lastFrame=lastFrame=this.frames[1]||this.frames[0],this.currentFrame=0};e.prototype.start=function(){this.currentFrame=this.firstFrame;var t=this;this._interval=setInterval(function(){t.update()},1e3/this.framesPerSecond)},e.prototype.stop=function(){return this._interval&&clearInterval(this._interval),this},e.prototype.update=function(){this.currentFrame==this.lastFrame?(this.currentFrame=this.firstFrame,this.parent.trigger("animationStart")):(this.currentFrame=this.currentFrame+1,this.currentFrame==this.lastFrame&&this.parent.trigger("animationEnd"))},t.SpriteAnimation=e}(Joy),function(t){var e=t.Sprite.extend({init:function(t){if(this._super(t),this.animations={length:0},this._frequencyInterval=null,this.frames=1,this.framesPerSecond=t.framesPerSecond||t.fps||24,t.animations)for(var e in t.animations)this.addAnimation(e,t.animations[e]);this.currentAnimationName="all",Object.defineProperty(this,"fps",{get:function(){return this.framesPerSecond},configurable:!0}),Object.defineProperty(this,"currentAnimation",{get:function(){return this.animations[this.currentAnimationName]},configurable:!0})},addAnimation:function(e,i){return this.animations[e]=new t.SpriteAnimation({parent:this,name:e,frames:i instanceof Array?i:i.frames,framesPerSecond:i.framesPerSecond||this.framesPerSecond}),this.animations.length=(this.animations.length||0)+1,this},onLoad:function(){this._super();var t=1;this._width<this.image.width&&(t=this._columns=Math.ceil(this.image.width/this._width)),this._height<this.image.height&&(t*=this._rows=Math.ceil(this.image.height/this._height)),this.addAnimation("all",[0,t-1]),(0===this.animations.length||null===this.currentAnimation)&&this.play("all")},play:function(t){if(this.currentAnimationName!=t){if(this.currentAnimation&&this.currentAnimation.stop(),this.currentAnimationName=t,!this.animations[t])throw Error("Animation '"+t+"' not found on '"+this.id+"'");this.animations[t].start()}return this},stop:function(){this.currentAnimation.stop()},render:function(){this.visible&&this.ctx.drawImage(this.image,this._width*(this.currentAnimation.currentFrame%this._columns),this._height*(this.currentAnimation.currentFrame/this._columns>>0),this._width,this._height,0,0,this._width,this._height)}});t.SpriteSheet=e}(Joy),function(t){var e={TOP:"top",HANGING:"hanging",MIDDLE:"middle",ALPHABETIC:"alphabetic",IDEOGRAPHIC:"ideographic",BOTTOM:"bottom"},i="Normal 12px Verdana",n="#000000",o="left",r=e.TOP,s=t.DisplayObject.extend({init:function(t){t===void 0&&(t={}),this._super(t),this.text=t.text||"",this.font=t.font||i,this.align=t.align||o,this.baseline=t.baseline||r,this._color=t.color||n,Object.defineProperty(this,"color",{get:function(){return this._color},set:function(t){this._color=""+t},configurable:!0}),t.stroke?this.useStroke():this.useFill()},useStroke:function(){this.stroke=!0,this.fillMethod="strokeText",this.styleMethod="strokeStyle"},useFill:function(){this.stroke=!1,this.fillMethod="fillText",this.styleMethod="fillStyle"},updateContext:function(){this._super(),this.ctx.font=this.font,this.ctx.textAlign=this.align,this.ctx.textBaseline=this.baseline,this.ctx[this.styleMethod]=this.color,this.ctx[this.fillMethod](this.text,0,0)},getMeasure:function(){return this.ctx.measureText(this.text)}});s.BASELINE=e,t.Text=s}(Joy),function(t){var e=t.DisplayObjectContainer.extend({init:function(e){if(!(e.tileset instanceof t.Tileset))throw Error("'tileset' must be given on Tilemap constructor, as Sprite instance.");this._super(e),this.tileset=e.tileset,this.lines=e.lines||1,this.columns=e.columns||1,Object.defineProperty(this,"data",{get:function(){return this._data},set:function(e){this._data=e,(this.collider==this||this.collider instanceof t.TilemapCollider)&&(this.collider=new t.TilemapCollider(this))},configurable:!0}),this.data=e.data,Object.defineProperty(this,"height",{get:function(){return this.lines*this.tileset.tileHeight},configurable:!0}),Object.defineProperty(this,"width",{get:function(){return this.columns*this.tileset.tileWidth},configurable:!0}),this.bind(t.Events.ADDED,function(){this.tileset.trigger(t.Events.ADDED)})},renderChildren:function(){for(var t=0,e=this.data.length;e>t;++t)0!==this.data[t]&&this.ctx.drawImage(this.tileset.image,this.tileset.tileWidth*((this.data[t]-1)%this.tileset.columns),this.tileset.tileHeight*((this.data[t]-1)/this.tileset.columns>>0),this.tileset.tileWidth,this.tileset.tileHeight,this.tileset.tileWidth*(t%this.columns),this.tileset.tileHeight*(t/this.columns>>0),this.tileset.tileWidth,this.tileset.tileHeight)}});t.Tilemap=e}(Joy),function(t){var e=t.Sprite.extend({init:function(t){this.tileWidth=t.width,this.tileHeight=t.height,delete t.width,delete t.height,this._super(t)},onLoad:function(){this._super(),this.columns=this._width/this.tileWidth>>0,this.lines=this._height/this.tileHeight>>0}});t.Tileset=e}(Joy),function(t){var e=t.Triggerable.extend({init:function(e){this._super(e),this.id=e.id||Joy.generateUniqueId(),this.position=new t.Vector2d,this._lastPosition=new t.Vector2d,this.translation=new t.Vector2d,e.scene&&(this.scene=e.scene,this.ctx=this.scene.ctx),this.hud=new t.DisplayObjectContainer({id:this.id+"_HUD",ctx:this.ctx}),this.hud.position=this.position,this.active=!0,this._translationTotal=new t.Vector2d,this.setup(e)},addHud:function(t){return this.hud.addChild(t)},setup:function(e){this.width=e.width||this.scene.ctx.canvas.width,this.height=e.height||this.scene.ctx.canvas.height,e.follow&&(this.follow=e.follow),this.scale=new t.Vector2d(1,1),this.bind(t.Events.SCENE_ACTIVE,function(){this.width&&this.height&&this.setSize(this.width,this.height),this.trigger("setup")})},setSize:function(t,e){return this.reset(),this.width=t,this.height=e,this.ctx.scale(this.ctx.canvas.width/this.width*this.scale.x,this.ctx.canvas.height/this.height*this.scale.y),this.scale.x=this.width/this.ctx.canvas.width,this.scale.y=this.height/this.ctx.canvas.height,this},setDeadzone:function(e,i){return this.deadzone=new t.Vector2d(e,i),this},updateContext:function(){this.width/2,this.height/2,this.position.x=~~(this.follow.position.x+this.follow.width/2-this.width/2),this.position.y=~~(this.follow.position.y+this.follow.height/2-this.height/2),this.translation.x=-this.position.x+this._lastPosition.x,this.translation.y=-this.position.y+this._lastPosition.y,this._translationTotal.sum(this.translation),this.active&&(this.trigger("translate"),this.ctx.translate(this.translation.x,this.translation.y)),this._lastPosition.x=this.position.x,this._lastPosition.y=this.position.y},render:function(){this.hud.render()},reset:function(){return this.translation.x=-this._translationTotal.x,this.translation.y=-this._translationTotal.y,this.ctx.translate(this.translation.x,this.translation.y),this.trigger("translate"),this._translationTotal.set(0,0),this._lastPosition.set(0,0),this}});t.Viewport=e}(Joy),function(t){var e=t.DisplayObject.extend({init:function(t){this._super(t),this.radius=t.radius||1,this.color=t.color||"#000",Object.defineProperty(this,"width",{get:function(){return 2*this.radius*this.scale.x},configurable:!0}),Object.defineProperty(this,"height",{get:function(){return 2*this.radius*this.scale.y},configurable:!0})},render:function(){this.ctx.beginPath(),this.ctx.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.ctx.fillStyle=this.color,this.ctx.fill()}});t.Circle=e}(Joy),function(t){var e=t.DisplayObject.extend({init:function(t){this._super(t),t.color&&this.colorize(t.color)},colorize:function(t){return this.color=""+t,this},render:function(){this.color&&(this.ctx.fillStyle=this.color),this.ctx.fillRect(0,0,this._width,this._height)}});t.Rect=e}(Joy),function(t){var e=t.Object.extend({});e.behaviours={},e.define=function(t,i){return this.behaviours[t]=e.extend(i),this.behaviours[t].id=t,this.behaviours[name]},e.get=function(t){return this.behaviours[t]},Joy.Behaviour=e}(Joy),/*!
 *  howler.js v1.1.7
 *  howlerjs.com
 *
 *  (c) 2013, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){var t={},e=null,i=!0,n=!1;if("undefined"!=typeof AudioContext?e=new AudioContext:"undefined"!=typeof webkitAudioContext?e=new webkitAudioContext:"undefined"!=typeof Audio?i=!1:(i=!1,n=!0),i){var o=e.createGain===void 0?e.createGainNode():e.createGain();o.gain.value=1,o.connect(e.destination)}var r=function(){this._volume=1,this._muted=!1,this.usingWebAudio=i,this._howls=[]};r.prototype={volume:function(t){var e=this;if(t=parseFloat(t),t&&t>=0&&1>=t){e._volume=t,i&&(o.gain.value=t);for(var n in e._howls)if(e._howls.hasOwnProperty(n)&&e._howls[n]._webAudio===!1)for(var r=0;e._howls[n]._audioNode.length>r;r++)e._howls[n]._audioNode[r].volume=e._howls[n]._volume*e._volume;return e}return i?o.gain.value:e._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(t){var e=this;e._muted=t,i&&(o.gain.value=t?0:e._volume);for(var n in e._howls)if(e._howls.hasOwnProperty(n)&&e._howls[n]._webAudio===!1)for(var r=0;e._howls[n]._audioNode.length>r;r++)e._howls[n]._audioNode[r].muted=t}};var s=new r,a=null;if(!n){a=new Audio;var h={mp3:!!a.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),m4a:!!(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),webm:!!a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")}}var c=function(t){var e=this;e._autoplay=t.autoplay||!1,e._buffer=t.buffer||!1,e._duration=t.duration||0,e._format=t.format||null,e._loop=t.loop||!1,e._loaded=!1,e._sprite=t.sprite||{},e._src=t.src||"",e._pos3d=t.pos3d||[0,0,-.5],e._volume=t.volume||1,e._urls=t.urls||[],e._onload=[t.onload||function(){}],e._onloaderror=[t.onloaderror||function(){}],e._onend=[t.onend||function(){}],e._onpause=[t.onpause||function(){}],e._onplay=[t.onplay||function(){}],e._onendTimer=[],e._webAudio=i&&!e._buffer,e._audioNode=[],e._webAudio&&e._setupAudioNode(),s._howls.push(e),e.load()};if(c.prototype={load:function(){var e=this,i=null;if(n)return e.on("loaderror"),void 0;for(var o={mp3:h.mp3,opus:h.opus,ogg:h.ogg,wav:h.wav,m4a:h.m4a,weba:h.webm},r=0;e._urls.length>r;r++){var a;if(e._format?a=e._format:(a=e._urls[r].toLowerCase().match(/.+\.([^?]+)(\?|$)/),a=a&&a.length>=2?a[1]:e._urls[r].toLowerCase().match(/data\:audio\/([^?]+);/)[1]),o[a]){i=e._urls[r];break}}if(!i)return e.on("loaderror"),void 0;if(e._src=i,e._webAudio)u(e,i);else{var c=new Audio;e._audioNode.push(c),c.src=i,c._pos=0,c.preload="auto",c.volume=s._muted?0:e._volume*s.volume(),t[i]=e;var l=function(){e._duration=c.duration,0===Object.getOwnPropertyNames(e._sprite).length&&(e._sprite={_default:[0,1e3*e._duration]}),e._loaded||(e._loaded=!0,e.on("load")),e._autoplay&&e.play(),c.removeEventListener("canplaythrough",l,!1)};c.addEventListener("canplaythrough",l,!1),c.load()}return e},urls:function(t){var e=this;return t?(e._urls=t,e._loaded=!1,e.stop(),e.load(),e):e._urls},play:function(t,i){var n=this;return"function"==typeof t&&(i=t),t&&"function"!=typeof t||(t="_default"),n._loaded?n._sprite[t]?(n._inactiveNode(function(o){o._sprite=t;var r,a=o._pos>0?o._pos:n._sprite[t][0]/1e3,h=n._sprite[t][1]/1e3-o._pos,c=!(!n._loop&&!n._sprite[t][2]),u="string"==typeof i?i:Math.round(Date.now()*Math.random())+"";if(function(){var e={id:u,sprite:t,loop:c};r=setTimeout(function(){!n._webAudio&&c&&n.stop(e.id,e.timer).play(t,e.id),n._webAudio&&!c&&(n._nodeById(e.id).paused=!0),n._webAudio||c||n.stop(e.id,e.timer),n.on("end",u)},1e3*h),n._onendTimer.push(r),e.timer=n._onendTimer[n._onendTimer.length-1]}(),n._webAudio)o.id=u,o.paused=!1,d(n,[c,a,h],u),n._playStart=e.currentTime,o.gain.value=n._volume,o.bufferSource.start===void 0?o.bufferSource.noteGrainOn(0,a,h):o.bufferSource.start(0,a,h);else{if(4!==o.readyState)return n._clearEndTimer(r),function(){var e=n,r=t,s=i,a=o,h=function(){e.play(r,s),a.removeEventListener("canplaythrough",h,!1)};a.addEventListener("canplaythrough",h,!1)}(),n;o.id=u,o.currentTime=a,o.muted=s._muted,o.volume=n._volume*s.volume(),o.play()}return n.on("play"),"function"==typeof i&&i(u),n}),n):("function"==typeof i&&i(),n):(n.on("load",function(){n.play(t,i)}),n)},pause:function(t,i){var n=this;if(!n._loaded)return n.on("play",function(){n.pause(t)}),n;n._clearEndTimer(i||0);var o=t?n._nodeById(t):n._activeNode();if(o)if(n._webAudio){if(!o.bufferSource)return n;o.paused=!0,o._pos+=e.currentTime-n._playStart,o.bufferSource.stop===void 0?o.bufferSource.noteOff(0):o.bufferSource.stop(0)}else o._pos=o.currentTime,o.pause();return n.on("pause"),n},stop:function(t,e){var i=this;if(!i._loaded)return i.on("play",function(){i.stop(t)}),i;i._clearEndTimer(e||0);var n=t?i._nodeById(t):i._activeNode();if(n)if(n._pos=0,i._webAudio){if(!n.bufferSource)return i;n.paused=!0,n.bufferSource.stop===void 0?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else n.pause(),n.currentTime=0;return i},mute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.mute(t)}),e;var i=t?e._nodeById(t):e._activeNode();return i&&(e._webAudio?i.gain.value=0:i.volume=0),e},unmute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.unmute(t)}),e;var i=t?e._nodeById(t):e._activeNode();return i&&(e._webAudio?i.gain.value=e._volume:i.volume=e._volume),e},volume:function(t,e){var i=this;if(t=parseFloat(t),!i._loaded)return i.on("play",function(){i.volume(t,e)}),i;if(t>=0&&1>=t){i._volume=t;var n=e?i._nodeById(e):i._activeNode();return n&&(i._webAudio?n.gain.value=t:n.volume=t*s.volume()),i}return i._volume},loop:function(t){var e=this;return"boolean"==typeof t?(e._loop=t,e):e._loop},sprite:function(t){var e=this;return"object"==typeof t?(e._sprite=t,e):e._sprite},pos:function(t,i){var n=this;if(!n._loaded)return n.on("load",function(){n.pos(t)}),n;var o=i?n._nodeById(i):n._activeNode();return o?n._webAudio?t>=0?(o._pos=t,n.pause(i).play(o._sprite,i),n):o._pos+(e.currentTime-n._playStart):t>=0?(o.currentTime=t,n):o.currentTime:void 0},pos3d:function(t,e,i,n){var o=this;if(e=void 0!==e&&e?e:0,i=void 0!==i&&i?i:-.5,!o._loaded)return o.on("play",function(){o.pos3d(t,e,i,n)}),o;if(!(t>=0||0>t))return o._pos3d;if(o._webAudio){var r=n?o._nodeById(n):o._activeNode();r&&(o._pos3d=[t,e,i],r.panner.setPosition(t,e,i))}return o},fade:function(t,e,i,n,o){var r=this,s=Math.abs(t-e),a=t>e?"down":"up",h=s/.01,c=i/h;if(!r._loaded)return r.on("load",function(){r.fade(t,e,i,n,o)}),r;r.volume(t,o);for(var u=1;h>=u;u++)(function(){var t=r._volume+("up"===a?.01:-.01)*u,i=Math.round(1e3*t)/1e3,s=e;setTimeout(function(){r.volume(i,o),i===s&&n&&n()},c*u)})()},fadeIn:function(t,e,i){return this.volume(0).play().fade(0,t,e,i)},fadeOut:function(t,e,i,n){var o=this;return o.fade(o._volume,t,e,function(){i&&i(),o.pause(n),o.on("end")},n)},_nodeById:function(t){for(var e=this,i=e._audioNode[0],n=0;e._audioNode.length>n;n++)if(e._audioNode[n].id===t){i=e._audioNode[n];break}return i},_activeNode:function(){for(var t=this,e=null,i=0;t._audioNode.length>i;i++)if(!t._audioNode[i].paused){e=t._audioNode[i];break}return t._drainPool(),e},_inactiveNode:function(t){for(var e=this,i=null,n=0;e._audioNode.length>n;n++)if(e._audioNode[n].paused&&4===e._audioNode[n].readyState){t(e._audioNode[n]),i=!0;break}if(e._drainPool(),!i){var o;e._webAudio?(o=e._setupAudioNode(),t(o)):(e.load(),o=e._audioNode[e._audioNode.length-1],o.addEventListener("loadedmetadata",function(){t(o)}))}},_drainPool:function(){var t,e=this,i=0;for(t=0;e._audioNode.length>t;t++)e._audioNode[t].paused&&i++;for(t=e._audioNode.length-1;t>=0&&!(5>=i);t--)e._audioNode[t].paused&&(i--,e._audioNode.splice(t,1))},_clearEndTimer:function(t){var e=this,i=e._onendTimer.indexOf(t);i=i>=0?i:0,e._onendTimer[i]&&(clearTimeout(e._onendTimer[i]),e._onendTimer.splice(i,1))},_setupAudioNode:function(){var t=this,i=t._audioNode,n=t._audioNode.length;return i[n]=e.createGain===void 0?e.createGainNode():e.createGain(),i[n].gain.value=t._volume,i[n].paused=!0,i[n]._pos=0,i[n].readyState=4,i[n].connect(o),i[n].panner=e.createPanner(),i[n].panner.setPosition(t._pos3d[0],t._pos3d[1],t._pos3d[2]),i[n].panner.connect(i[n]),i[n]},on:function(t,e){var i=this,n=i["_on"+t];if("function"==typeof e)n.push(e);else for(var o=0;n.length>o;o++)e?n[o].call(i,e):n[o].call(i);return i},off:function(t,e){for(var i=this,n=i["_on"+t],o=""+e,r=0;n.length>r;r++)if(o===""+n[r]){n.splice(r,1);break}return i}},i)var u=function(i,n){if(n in t)i._duration=t[n].duration,l(i);else{var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.onload=function(){e.decodeAudioData(o.response,function(e){e&&(t[n]=e,l(i,e))})},o.onerror=function(){i._webAudio&&(i._buffer=!0,i._webAudio=!1,i._audioNode=[],delete i._gainNode,i.load())};try{o.send()}catch(r){o.onerror()}}},l=function(t,e){t._duration=e?e.duration:t._duration,0===Object.getOwnPropertyNames(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play()},d=function(i,n,o){var r=i._nodeById(o);r.bufferSource=e.createBufferSource(),r.bufferSource.buffer=t[i._src],r.bufferSource.connect(r.panner),r.bufferSource.loop=n[0],n[0]&&(r.bufferSource.loopStart=n[1],r.bufferSource.loopEnd=n[1]+n[2])};"function"==typeof define&&define.amd?define("Howler",function(){return{Howler:s,Howl:c}}):(window.Howler=s,window.Howl=c)}();var TWEEN=TWEEN||function(){var t=[];return{REVISION:"10",getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)},update:function(e){if(0===t.length)return!1;var i=0,n=t.length;for(e=void 0!==e?e:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();n>i;)t[i].update(e)?i++:(t.splice(i,1),n--);return!0}}}();TWEEN.Tween=function(t){var e=t,i={},n={},o={},r=1e3,s=0,a=0,h=null,c=TWEEN.Easing.Linear.None,u=TWEEN.Interpolation.Linear,l=[],d=null,f=!1,p=null,v=null;for(var g in t)i[g]=parseFloat(t[g],10);this.to=function(t,e){return void 0!==e&&(r=e),n=t,this},this.start=function(t){TWEEN.add(this),f=!1,h=void 0!==t?t:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),h+=a;for(var r in n){if(n[r]instanceof Array){if(0===n[r].length)continue;n[r]=[e[r]].concat(n[r])}i[r]=e[r],i[r]instanceof Array==!1&&(i[r]*=1),o[r]=i[r]||0}return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(t){return a=t,this},this.repeat=function(t){return s=t,this},this.easing=function(t){return c=t,this},this.interpolation=function(t){return u=t,this},this.chain=function(){return l=arguments,this},this.onStart=function(t){return d=t,this},this.onUpdate=function(t){return p=t,this},this.onComplete=function(t){return v=t,this},this.update=function(t){if(h>t)return!0;f===!1&&(null!==d&&d.call(e),f=!0);var g=(t-h)/r;g=g>1?1:g;var y=c(g);for(var m in n){var _=i[m]||0,w=n[m];w instanceof Array?e[m]=u(w,y):("string"==typeof w&&(w=_+parseFloat(w,10)),e[m]=_+(w-_)*y)}if(null!==p&&p.call(e,y),1==g){if(s>0){isFinite(s)&&s--;for(var m in o)"string"==typeof n[m]&&(o[m]=o[m]+parseFloat(n[m],10)),i[m]=o[m];return h=t+a,!0}null!==v&&v.call(e);for(var x=0,E=l.length;E>x;x++)l[x].start(t);return!1}return!0}},TWEEN.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return 1>(t*=2)?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:1>(t*=2)?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*2*Math.PI/n)))},Out:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*2*Math.PI/n)+1)},InOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),1>(t*=2)?-.5*i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*2*Math.PI/n):.5*i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*2*Math.PI/n)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return 1>(t*=2)?.5*t*t*((e+1)*t-e):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-TWEEN.Easing.Bounce.Out(1-t)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*TWEEN.Easing.Bounce.In(2*t):.5*TWEEN.Easing.Bounce.Out(2*t-1)+.5}}},TWEEN.Interpolation={Linear:function(t,e){var i=t.length-1,n=i*e,o=Math.floor(n),r=TWEEN.Interpolation.Utils.Linear;return 0>e?r(t[0],t[1],n):e>1?r(t[i],t[i-1],i-n):r(t[o],t[o+1>i?i:o+1],n-o)},Bezier:function(t,e){var i,n=0,o=t.length-1,r=Math.pow,s=TWEEN.Interpolation.Utils.Bernstein;for(i=0;o>=i;i++)n+=r(1-e,o-i)*r(e,i)*t[i]*s(o,i);return n},CatmullRom:function(t,e){var i=t.length-1,n=i*e,o=Math.floor(n),r=TWEEN.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(0>e&&(o=Math.floor(n=i*(1+e))),r(t[(o-1+i)%i],t[o],t[(o+1)%i],t[(o+2)%i],n-o)):0>e?t[0]-(r(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(r(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):r(t[o?o-1:0],t[o],t[o+1>i?i:o+1],t[o+2>i?i:o+2],n-o)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=TWEEN.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i,n=1;if(t[e])return t[e];for(i=e;i>1;i--)n*=i;return t[e]=n}}(),CatmullRom:function(t,e,i,n,o){var r=.5*(i-t),s=.5*(n-e),a=o*o,h=o*a;return(2*e-2*i+r+s)*h+(-3*e+3*i-2*r-s)*a+r*o+e}}},function(t){t.Sound=Howl}(Joy),function(t){t.TweenManager=TWEEN,t.Tween=function(t,e){return new TWEEN.Tween(t,e)}}(Joy),function(t){t.Behaviour.define("Button",{INIT:function(){this.isOver=!1},UPDATE:function(){var e=t.Mouse.isOver(this);e&&!this.isOver?this.trigger(t.Events.MOUSE_OVER):!e&&this.isOver&&this.trigger(t.Events.MOUSE_OUT),this.isOver=e}})}(Joy),function(t){t.Behaviour.Movimentation=t.Behaviour.define("Movimentation",{INIT:function(){this.velocity=new t.Vector2d,this.maxVelocity=new t.Vector2d(500,500),Object.defineProperty(this,"direction",{get:function(){return this.velocity.normalized},configurable:!0}),this.acceleration=new t.Vector2d,this.friction=new t.Vector2d},UPDATE:function(){this.friction.x&&(this.velocity.x=t.Utils.applyFriction(this.velocity.x,this.friction.x)),this.friction.y&&(this.velocity.y=t.Utils.applyFriction(this.velocity.y,this.friction.y)),this.velocity.x+=this.acceleration.x*t.deltaTime,this.velocity.y+=this.acceleration.y*t.deltaTime,0!==this.velocity.x&&(this.velocity.x=Math.clamp(this.velocity.x,-this.maxVelocity.x,this.maxVelocity.x)),0!==this.velocity.y&&(this.velocity.y=Math.clamp(this.velocity.y,-this.maxVelocity.y,this.maxVelocity.y)),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}})}(Joy),function(t){function e(e,i){var n={};return n.position=new t.Vector2d,n.position.x=e.position.x+t.Range.parse(i.position&&i.position.x||{}).randomInt(),n.position.y=e.position.y+t.Range.parse(i.position&&i.position.y||{}).randomInt(),n.scale=new t.Vector2d,n.scale.x=t.Range.parse(i.scale&&i.scale.x||e.scale.x).randomInt(),n.scale.y=t.Range.parse(i.scale&&i.scale.y||e.scale.y).randomInt(),n.alpha=t.Range.parse(i.alpha===void 0?e.alpha:i.alpha).randomInt(),n.rotation=t.Range.parse(i.rotation===void 0?e.rotation:i.rotation).randomInt(),n}t.Behaviour.define("Particle",{init:function(t){this.particleOptions=t},ADDED:function(){var i=e(this.particleOptions.emitter,this.particleOptions.start||{}),n=e(this.particleOptions.emitter,this.particleOptions.end||{});for(var o in i)this[o]=i[o],"object"==typeof n[o]&&(t.Tween(i[o],1e3*this.particleOptions.ttl).to(n[o]).start(),delete n[o]);t.Tween(this,1e3*this.particleOptions.ttl).to(n).onComplete(this.destroy).start()}})}(Joy),function(t){t.Behaviour.define("Physics",{INIT:function(){},UPDATE:function(){}})}(Joy),function(t){var e=function(e,i,n){this.id=t.generateUniqueId(),this.position=e,this.collidePosition=this.position.clone(),this.width=i,this.height=n};e.prototype.updateColliderPosition=function(t){this.collidePosition.x=t.x+this.position.x,this.collidePosition.y=t.y+this.position.y},e.prototype.renderStroke=function(t){t.strokeStyle="red",t.strokeRect(this.collidePosition.x,this.collidePosition.y,this.width,this.height)},e.prototype.collide=function(t){return!(this.collidePosition.x>=t.collidePosition.x+t.width||t.collidePosition.x>=this.collidePosition.x+this.width||this.collidePosition.y>=t.collidePosition.y+t.height||t.collidePosition.y>=this.collidePosition.y+this.height)},e.prototype.clone=function(){return new e(this.position.clone(),this.width,this.height)},t.RectCollider=e}(Joy),function(t){var e=function(e){this.blocks=[];for(var i=0,n=e.data.length;n>i;++i)0!==e.data[i]&&this.blocks.push(new Joy.RectCollider(new t.Vector2d(e.tileset.tileWidth*(i%e.columns),e.tileset.tileHeight*(i/e.columns>>0)),e.tileset.tileWidth,e.tileset.tileHeight));this.length=this.blocks.length};e.prototype.collide=function(t){for(var e=0;this.length>e;++e)if(!(this.blocks[e].collidePosition.x>=t.collidePosition.x+t.width||t.collidePosition.x>=this.blocks[e].collidePosition.x+this.blocks[e].width||this.blocks[e].collidePosition.y>=t.collidePosition.y+t.height||t.collidePosition.y>=this.blocks[e].collidePosition.y+this.blocks[e].height))return!0;return!1},e.prototype.renderStroke=function(t){for(var e=0;this.length>e;++e)t.strokeRect(this.blocks[e].position.x,this.blocks[e].position.y,this.blocks[e].width,this.blocks[e].height)},t.TilemapCollider=e}(Joy),function(t){var e=function(t){this.setCanvas(t.canvas)};e.prototype.setCanvas=function(t){return this.canvas=t,this.ctx=t.getContext("2d"),this},e.prototype.clear=function(){return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this},e.prototype.render=function(t){this.clear();for(var e=0,i=t.length;i>e;++e)t[e].visible&&t[e].render()},t.Context.Context2d=e}(Joy),function(J){var Markup=function(t){this.engine=t,this.canvas=t.context.canvas,this.parsers={IMG:function(t,e){return new J.Sprite(e)},LABEL:function(t,e){return e.text=t.innerHTML,new J.Text(e)},DIV:function(t,e){for(var i=new J.DisplayObjectContainer(e),n=t.querySelector("*"),o=0,r=n.length;r>o;o++)i.addChild(this.parsers[n[o].tagName].apply(this,[n[o],Markup.evaluateDataset(n[o])]));return i},AUDIO:function(){new J.Sound({})}}};Markup.prototype.parse=function(){var t=this.canvas.querySelectorAll("section");0===t.length&&(t=[this.canvas]);for(var e=0;t.length>e;e++)this.createScene(t[e])},Markup.prototype.createScene=function(t){var e,i,n=[],o=t.querySelectorAll("*");for(e=0,i=o.length;i>e;++e)if(this.parsers[o[e].tagName]){var r=this.parsers[o[e].tagName].apply(this,[o[e],Markup.evaluateDataset(o[e])]);n.push(r)}var s=Markup.evaluateDataset(t);this.engine.createScene(function(t){for(var o in s)console.log(o,s[o]),"function"==typeof t[o]?t[o](s[o]):t[o]=s[o];for(e=0,i=n.length;i>e;++e)t.addChild(n[e])})},Markup.evaluateDataset=function(el){var value,matches,attr,attributeName,attributes=el.attributes,obj={};for(var key in attributes)attr=attributes[key],"object"==typeof attr&&(value=""===attr.value?!0:attr.value,attributeName=attr.name,0===attributeName.indexOf("data-")&&(attributeName=attributeName.substr(5,attributeName.length)),matches=attr.value.match(/\{\{([^\}]*)\}\}/),matches&&(value=value.replace(value,eval(matches[1]))),obj[attributeName]=value);return obj},J.Markup=Markup}(Joy),function(t){var e=function(){};t.Package=e}(Joy),function(t){function e(t,e){var n,o,r=i.handlers[t];for(n=0,o=r.length;o>n;++n)r[n].handler.apply(r[n].target,[e])}var i={ENTER:13,SPACE:32,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222};t.Events.KEY_DOWN="onkeydown",t.Events.KEY_UP="onkeyup",t.Events.KEY_PRESS="key",i.repeatRate=1,i.handlers={},i.timers={},[t.Events.KEY_DOWN,t.Events.KEY_UP,t.Events.KEY_PRESS].forEach(function(e){i.handlers[e]=[],t.Triggerable.register(e,function(t){-1===i.handlers[e].indexOf(t)&&i.handlers[e].push(t)},function(t){var n=i.handlers[e].indexOf(t);-1!==n&&i.handlers[e].splice(n,1)})}),document.onkeydown=function(n){var o=(n||window.event).keyCode;return i.timers[o]||(e(t.Events.KEY_DOWN,n),e(t.Events.KEY_PRESS,n),0!==i.repeatRate&&(i.timers[o]=setInterval(function(){e(t.Events.KEY_PRESS,n)},i.repeatRate))),!1},document.onkeyup=function(n){var o=(n||window.event).keyCode;o in i.timers&&(e(t.Events.KEY_UP,n),i.timers[o]&&clearInterval(i.timers[o]),delete i.timers[o])},Joy.Keyboard=i}(Joy),function(t){var e={collider:new t.RectCollider(new t.Vector2d,1,1),lastEvent:null,updateColliderPosition:function(i){e.collider.position.x=i.offsetX*t.currentEngine.currentScene.viewport.scale.x,e.collider.position.y=i.offsetY*t.currentEngine.currentScene.viewport.scale.y,e.collider.updateColliderPosition(t.currentEngine.currentScene.viewport.position)},isOver:function(t){return t.collider.collide(e.collider)},enable:function(i){var n=function(t){var i=e.handlers[t.type];this.lastEvent=t,e.updateColliderPosition(t);for(var n=0,o=i.length;o>n;++n)i[n].target.visible&&e.isOver(i[n].target)&&i[n].handler.apply(i[n].target,[t])};i.context.canvas["on"+t.Events.CLICK]=n,i.context.canvas["on"+t.Events.DOUBLE_CLICK]=n,i.context.canvas["on"+t.Events.MOUSE_MOVE]=n,i.context.canvas["on"+t.Events.MOUSE_DOWN]=n,i.context.canvas["on"+t.Events.MOUSE_UP]=n},handlers:{},timers:{}};t.Events.MOUSE_DOWN="mousedown",t.Events.MOUSE_UP="mouseup",t.Events.MOUSE_MOVE="mousemove",t.Events.CLICK="click",t.Events.DOUBLE_CLICK="dblclick",t.Events.MOUSE_OVER="mouseover",t.Events.MOUSE_OUT="mouseout",[t.Events.CLICK,t.Events.DOUBLE_CLICK,t.Events.DOUBLE_CLICK,t.Events.MOUSE_MOVE,t.Events.MOUSE_DOWN,t.Events.MOUSE_UP].forEach(function(i){e.handlers[i]=[],t.Triggerable.register(i,function(t){-1===e.handlers[i].indexOf(t)&&e.handlers[i].push(t)},function(t){var n=e.handlers[i].indexOf(t);-1!==n&&e.handlers[i].splice(n,1)})}),t.Mouse=e}(Joy),function(t){if(t.Support.touch){var e={};t.Events.TOUCH_START="touchstart",t.Events.TOUCH_MOVE="touchmove",t.Events.TOUCH_END="touchend",t.Touch=e}}(Joy);